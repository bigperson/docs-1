# GraphQL

**GraphQL** - это современная замена, в некотором роде, устаревшего подхода 
**REST** к разработке API. Прошло почти 17 лет с момента, когда идея **REST** была 
разработана Роем Филдингом в 2000 году. И со всей любовью ко всему, что было сделано
с помощью **REST**, пришло время изменить что-то в лучшую сторону.
 
**GraphQL** является шагом в будущее во многих отношениях и имеет фундаментальные 
улучшения над старым добрым **REST**:

- Базовая проверка типов, встроенная на уровне архитектуры ПО.
- Переиспользуемый **API** для разных клиентов и устройств, 
т.е. нет необходимости в поддержке `/v1`, `/v2` или `/v10002545.07E20`.
- Совершенно новый уровень абстракции между логикой _backend_ и _frontend_.
- Автогенерируемая документация и интуитивный способ изучения нового **API**.
- После завершения архитектуры проекта – большинство "клиентских" модификаций не потребует изменения "бэкенда".

В это может быть трудно поверить, но стоит просто поробовать и вы будете вознаграждены гораздо лучшей архитектурой, 
и гораздо легче поддерживамым кодом.

Сервис **GraphQL** создается путем определения типов и полей в этих типах, 
а затем предоставления функций для каждого поля и для каждого определённого типа.

## Схема

Каждое **GraphQL API** начинается с описания схемы. 
Такие схемы в терминах GraphQL называются 
<abbr title="Interface Definition Language">IDL</abbr> или 
<abbr title="Schema Definition Language">SDL</abbr>.

Например, наше API должно возвращать 
список пользователей и иметь возможность получить какого-то одного 
по идентификатору. В этом случае схема запроса может выглядеть следующим образом:  

```graphql
schema {
    # Это поле схемы ссылается на основной набор запросов вашего API.
    query: UsersApi
}

# Этот тип - объект, содержит набор полей, которые доступны в нашем API.
type UsersApi {
    # Поле пользователя (user) принимает один обязательный аргумент 
    # с типом "ID" - идентификатор требуемого пользователя и может 
    # возвращать объект пользвователя. 
    user(id: ID!): User
    
    # Поле пользователей (users) всегда возвращает список объектов 
    # пользователей.
    users: [User]!
}


# Объект пользователя - структура, которая будет возвращаться в ответах. 
type User {
    # Идентификатор нашего пользователя
    id: ID!
    
    # Имя пользователя
    login: String!
    
    # Дата создания пользователя
    createdAt: DateTime!
    
    # Дата обновления аккаунта пользователя.
    # Стоит заметить, что у возвращаемого типа нет символа "!" в конце.
    # Это значит, что в качестве результата этого поля может вернуться null.
    updatedAt: DateTime
}
```

## Запросы

Вышеприведённая схема описывает все допустимые запросы, их структуру 
и возвращаемые типы. Но для того чтобы воспользоваться её возможностями
следует сформировать нужный запрос. Подробнее о запросах можно 
почитать в [официальной документации](http://graphql.org/learn/queries/), 
здесь же мы остановимся непосредственно на примере запроса для описанной 
выше схемы, а так же ответе на этот запрос:

```graphql
{
    users {
        id
        login
    }
    
    user (42) {
        id
        createdAt
    }
}
``` 
 
Такой запрос должен сформировать примерно следующий ответ:

```json
{
    "users": [
        {
            "id": 23,
            "login": "Erwin Rudolf Josef Alexander Schrödinger"
        },
        {
            "id": 42,
            "login": "Max Otto von Stierlitz"
        }
    ],
    "user": {
        "id": 42,
        "createdAt": "1900-10-08T23:16:00+00:00"
    }
}
```


